import logging
from typing import Dict
import re

import re
from datetime import datetime, timedelta
logger = logging.getLogger(__name__)

def format_task_creation(description: str) -> str:
    """Format task creation response with parsed details"""
    if not description:
        return "ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, ÑƒÐºÐ°Ð¶Ð¸Ñ‚Ðµ Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ðµ Ð·Ð°Ð´Ð°Ñ‡Ð¸"
        
    # ÐžÑ‡Ð¸Ñ‰Ð°ÐµÐ¼ Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ðµ Ð¾Ñ‚ Ð»Ð¸ÑˆÐ½Ð¸Ñ… ÑÐ»Ð¾Ð²
    description = re.sub(r'^(Ñ‚ÐµÑ€Ð°|Ñ‚ÐµÑ€Ñ€Ð°|terra),?\s*', '', description.lower())
    
    # ÐŸÐ¾Ð¸ÑÐº Ð´Ð°Ñ‚Ñ‹ Ð² Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ð¸
    date_keywords = {
        'Ð·Ð°Ð²Ñ‚Ñ€Ð°': datetime.now() + timedelta(days=1),
        'ÑÐµÐ³Ð¾Ð´Ð½Ñ': datetime.now(),
        'Ð¿Ð¾ÑÐ»ÐµÐ·Ð°Ð²Ñ‚Ñ€Ð°': datetime.now() + timedelta(days=2)
    }
    
    task_date = None
    for keyword, date in date_keywords.items():
        if keyword in description:
            task_date = date
            description = description.replace(keyword, '').strip()
            break
    
    # Ð¤Ð¾Ñ€Ð¼Ð¸Ñ€ÑƒÐµÐ¼ Ð¾Ñ‚Ð²ÐµÑ‚
    response = "âœ… Ð¡Ð¾Ð·Ð´Ð°ÑŽ Ð½Ð¾Ð²ÑƒÑŽ Ð·Ð°Ð´Ð°Ñ‡Ñƒ:\n\n"
    response += f"ðŸ“ ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ: {description.capitalize()}\n"
    
    if task_date:
        response += f"ðŸ“… Ð”Ð°Ñ‚Ð°: {task_date.strftime('%d.%m.%Y')}\n"
    
    response += "\nÐ—Ð°Ð´Ð°Ñ‡Ð° ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ ÑÐ¾Ð·Ð´Ð°Ð½Ð° Ð¸ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð° Ð² ÑÐ¸ÑÑ‚ÐµÐ¼Ñƒ."
    
    return response

class CommandProcessor:
    def __init__(self):
        self.context = {}
        
    def _format_currency(self, amount: float) -> str:
        """Format currency amount with thousand separators"""
        return f"{amount:,.0f}"
        
    def handle_innovation(self, entities: Dict) -> str:
        """Handle innovation-related commands"""
        description = entities.get('description', '').lower()
        if not description:
            return "ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, ÑƒÑ‚Ð¾Ñ‡Ð½Ð¸Ñ‚Ðµ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸ÑŽ Ñ Ð¸Ð½Ð½Ð¾Ð²Ð°Ñ†Ð¸ÑÐ¼Ð¸"

        innovation_actions = {
            'Ð¿Ñ€Ð¾ÐµÐºÑ‚': 'projects',
            'Ð¸Ð´ÐµÐ¸': 'ideas',
            'ÑÑ‚Ð°Ñ‚ÑƒÑ': 'status',
            'Ð±ÑŽÐ´Ð¶ÐµÑ‚': 'budget',
            'Ñ‚ÐµÑ…Ð½Ð¾Ð»Ð¾Ð³Ð¸Ð¸': 'technologies',
            'Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹': 'results'
        }

        action = None
        for key, value in innovation_actions.items():
            if key in description:
                action = value
                break

        responses = {
            'projects': lambda: "Ð˜Ð½Ð½Ð¾Ð²Ð°Ñ†Ð¸Ð¾Ð½Ð½Ñ‹Ðµ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ñ‹:\n" + \
                               "Ð’ÑÐµÐ³Ð¾ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð¾Ð²: 12\n" + \
                               "Ð’ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐµ: 5\n" + \
                               "ÐÐ° Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ð¸: 3\n" + \
                               "Ð—Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¾: 4",
            'ideas': lambda: "Ð‘Ð°Ð½Ðº Ð¸Ð½Ð½Ð¾Ð²Ð°Ñ†Ð¸Ð¾Ð½Ð½Ñ‹Ñ… Ð¸Ð´ÐµÐ¹:\n" + \
                            "Ð’ÑÐµÐ³Ð¾ Ð¸Ð´ÐµÐ¹: 85\n" + \
                            "ÐÐ° Ñ€Ð°ÑÑÐ¼Ð¾Ñ‚Ñ€ÐµÐ½Ð¸Ð¸: 15\n" + \
                            "ÐžÐ´Ð¾Ð±Ñ€ÐµÐ½Ð¾: 7\n" + \
                            "Ð’ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸: 4",
            'status': lambda: "Ð¡Ñ‚Ð°Ñ‚ÑƒÑ Ð¸Ð½Ð½Ð¾Ð²Ð°Ñ†Ð¸Ð¹:\n" + \
                            "Ð£ÑÐ¿ÐµÑˆÐ½Ñ‹Ðµ Ð²Ð½ÐµÐ´Ñ€ÐµÐ½Ð¸Ñ: 8\n" + \
                            "ÐŸÐ¸Ð»Ð¾Ñ‚Ð½Ñ‹Ðµ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ñ‹: 3\n" + \
                            "ÐŸÐ°Ñ‚ÐµÐ½Ñ‚Ñ‹: 2\n" + \
                            "ÐŸÑ€Ð¾Ñ‚Ð¾Ñ‚Ð¸Ð¿Ñ‹: 5",
            'budget': lambda: f"Ð‘ÑŽÐ´Ð¶ÐµÑ‚ Ð½Ð° Ð¸Ð½Ð½Ð¾Ð²Ð°Ñ†Ð¸Ð¸:\n" + \
                            f"ÐžÐ±Ñ‰Ð¸Ð¹ Ð±ÑŽÐ´Ð¶ÐµÑ‚: {self._format_currency(25000000)} Ñ€ÑƒÐ±.\n" + \
                            f"Ð˜Ð·Ñ€Ð°ÑÑ…Ð¾Ð´Ð¾Ð²Ð°Ð½Ð¾: {self._format_currency(12000000)} Ñ€ÑƒÐ±.\n" + \
                            "ROI: 145%\n" + \
                            "Ð­ÐºÐ¾Ð½Ð¾Ð¼Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ ÑÑ„Ñ„ÐµÐºÑ‚: Ð’Ñ‹ÑÐ¾ÐºÐ¸Ð¹",
            'results': lambda: "Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ð¸Ð½Ð½Ð¾Ð²Ð°Ñ†Ð¸Ð¹:\n" + \
                              "ÐÐ¾Ð²Ñ‹Ðµ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ñ‹: 3\n" + \
                              "Ð£Ð»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¾Ñ†ÐµÑÑÐ¾Ð²: 15%\n" + \
                              "Ð­ÐºÐ¾Ð½Ð¾Ð¼Ð¸Ñ: " + self._format_currency(8000000) + " Ñ€ÑƒÐ±.\n" + \
                              "Ð£Ð´Ð¾Ð²Ð»ÐµÑ‚Ð²Ð¾Ñ€ÐµÐ½Ð½Ð¾ÑÑ‚ÑŒ: 92%",
            'technologies': lambda: "Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼Ñ‹Ðµ Ñ‚ÐµÑ…Ð½Ð¾Ð»Ð¾Ð³Ð¸Ð¸:\n" + \
                                  "AI/ML: 3 Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°\n" + \
                                  "Ð‘Ð»Ð¾ÐºÑ‡ÐµÐ¹Ð½: 1 Ð¿Ñ€Ð¾ÐµÐºÑ‚\n" + \
                                  "Ð Ð¾Ð±Ð¾Ñ‚Ð¸Ð·Ð°Ñ†Ð¸Ñ: 2 Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°\n" + \
                                  "Big Data: 4 Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°"
        }

        return responses.get(action or 'unknown', lambda: "ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»Ð¸Ñ‚ÑŒ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸ÑŽ Ñ Ð¸Ð½Ð½Ð¾Ð²Ð°Ñ†Ð¸ÑÐ¼Ð¸. ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, ÑƒÑ‚Ð¾Ñ‡Ð½Ð¸Ñ‚Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ.")()

    def process_command(self, command_type: str, entities: Dict) -> str:
        """Process the command based on its type"""
        logger.debug(f"Processing command of type: {command_type} with entities: {entities}")
        
        # ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¿Ñ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ñ
        if command_type == 'greeting':
            return "Ð—Ð´Ñ€Ð°Ð²ÑÑ‚Ð²ÑƒÐ¹Ñ‚Ðµ! Ð¯ - Ð²Ð°Ñˆ Ð±Ð¸Ð·Ð½ÐµÑ-Ð°ÑÑÐ¸ÑÑ‚ÐµÐ½Ñ‚ Ð¢Ð•Ð Ð Ð. Ð§ÐµÐ¼ Ð¼Ð¾Ð³Ñƒ Ð¿Ð¾Ð¼Ð¾Ñ‡ÑŒ?"
            
        # ÐœÐ°Ð¿Ð¿Ð¸Ð½Ð³ Ñ‚Ð¸Ð¿Ð¾Ð² ÐºÐ¾Ð¼Ð°Ð½Ð´ Ð½Ð° Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ¸
        handlers = {
            'innovation': self.handle_innovation,
            'marketing': self.handle_marketing,
            'client': self.handle_client,
            'supplier': self.handle_supplier,
            'contract': self.handle_contract,
            'quality': self.handle_quality,
            'risk': self.handle_risk,
            'strategy': self.handle_strategy,
            'task_creation': lambda x: format_task_creation(x.get('description', '')),
            'document_analysis': lambda x: "ÐÐ½Ð°Ð»Ð¸Ð·Ð¸Ñ€ÑƒÑŽ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚: " + x.get('description', 'Ð½Ðµ ÑƒÐºÐ°Ð·Ð°Ð½'),
            'search': lambda x: "Ð˜Ñ‰Ñƒ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ Ð¿Ð¾ Ð·Ð°Ð¿Ñ€Ð¾ÑÑƒ: " + x.get('description', 'Ð½Ðµ ÑƒÐºÐ°Ð·Ð°Ð½'),
            'calendar': lambda x: "Ð Ð°Ð±Ð¾Ñ‚Ð°ÑŽ Ñ ÐºÐ°Ð»ÐµÐ½Ð´Ð°Ñ€ÐµÐ¼: " + x.get('description', 'Ð½ÐµÑ‚ Ð´ÐµÑ‚Ð°Ð»ÐµÐ¹'),
            'contact': lambda x: "Ð Ð°Ð±Ð¾Ñ‚Ð°ÑŽ Ñ ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ð°Ð¼Ð¸: " + x.get('description', 'Ð½ÐµÑ‚ Ð´ÐµÑ‚Ð°Ð»ÐµÐ¹'),
            'reminder': lambda x: "Ð£ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÑŽ Ð½Ð°Ð¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ðµ: " + x.get('description', 'Ð±ÐµÐ· Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ñ'),
            'finance': lambda x: "Ð Ð°Ð±Ð¾Ñ‚Ð°ÑŽ Ñ Ñ„Ð¸Ð½Ð°Ð½ÑÐ°Ð¼Ð¸: " + x.get('description', 'Ð½ÐµÑ‚ Ð´ÐµÑ‚Ð°Ð»ÐµÐ¹'),
            'project': lambda x: "Ð Ð°Ð±Ð¾Ñ‚Ð°ÑŽ Ñ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð¾Ð¼: " + x.get('description', 'Ð½ÐµÑ‚ Ð´ÐµÑ‚Ð°Ð»ÐµÐ¹'),
            'sales': lambda x: "Ð Ð°Ð±Ð¾Ñ‚Ð°ÑŽ Ñ Ð¿Ñ€Ð¾Ð´Ð°Ð¶Ð°Ð¼Ð¸: " + x.get('description', 'Ð½ÐµÑ‚ Ð´ÐµÑ‚Ð°Ð»ÐµÐ¹'),
            'inventory': lambda x: "Ð Ð°Ð±Ð¾Ñ‚Ð°ÑŽ ÑÐ¾ ÑÐºÐ»Ð°Ð´Ð¾Ð¼: " + x.get('description', 'Ð½ÐµÑ‚ Ð´ÐµÑ‚Ð°Ð»ÐµÐ¹'),
            'analytics': lambda x: "ÐÐ½Ð°Ð»Ð¸Ð·Ð¸Ñ€ÑƒÑŽ Ð´Ð°Ð½Ð½Ñ‹Ðµ: " + x.get('description', 'Ð½ÐµÑ‚ Ð´ÐµÑ‚Ð°Ð»ÐµÐ¹'),
            'employee': lambda x: "Ð Ð°Ð±Ð¾Ñ‚Ð°ÑŽ Ñ Ð´Ð°Ð½Ð½Ñ‹Ð¼Ð¸ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ¾Ð²: " + x.get('description', 'Ð½ÐµÑ‚ Ð´ÐµÑ‚Ð°Ð»ÐµÐ¹'),
            'meeting': lambda x: "Ð Ð°Ð±Ð¾Ñ‚Ð°ÑŽ Ñ Ð²ÑÑ‚Ñ€ÐµÑ‡Ð°Ð¼Ð¸: " + x.get('description', 'Ð½ÐµÑ‚ Ð´ÐµÑ‚Ð°Ð»ÐµÐ¹')
        }
        
        try:
            # ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº Ð´Ð»Ñ Ð´Ð°Ð½Ð½Ð¾Ð³Ð¾ Ñ‚Ð¸Ð¿Ð° ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹
            handler = handlers.get(command_type)
            
            if handler:
                logger.info(f"Found handler for command type: {command_type}")
                return handler(entities)
            else:
                logger.warning(f"Unknown command type: {command_type}")
                return "Ð˜Ð·Ð²Ð¸Ð½Ð¸Ñ‚Ðµ, Ñ Ð½Ðµ Ñ€Ð°ÑÐ¿Ð¾Ð·Ð½Ð°Ð» ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ. ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð¿Ð¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ð¿ÐµÑ€ÐµÑ„Ð¾Ñ€Ð¼ÑƒÐ»Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ."
                
        except Exception as e:
            logger.error(f"Error processing command: {str(e)}", exc_info=True)
            return "ÐŸÑ€Ð¾Ð¸Ð·Ð¾ÑˆÐ»Ð° Ð¾ÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹. ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð¿Ð¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ ÐµÑ‰Ðµ Ñ€Ð°Ð·."


    def handle_marketing(self, entities: Dict) -> str:
        """Handle marketing-related commands"""
        description = entities.get('description', '').lower()
        if not description:
            return "ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, ÑƒÑ‚Ð¾Ñ‡Ð½Ð¸Ñ‚Ðµ Ð¼Ð°Ñ€ÐºÐµÑ‚Ð¸Ð½Ð³Ð¾Ð²ÑƒÑŽ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸ÑŽ"

        marketing_actions = {
            'ÐºÐ°Ð¼Ð¿Ð°Ð½Ð¸Ñ': 'campaign',
            'Ð°Ð½Ð°Ð»Ð¸Ð·': 'analysis',
            'Ð¿Ñ€Ð¾Ð´Ð²Ð¸Ð¶ÐµÐ½Ð¸Ðµ': 'promotion',
            'ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ñ': 'strategy',
            'Ð±Ñ€ÐµÐ½Ð´': 'brand',
            'ÑÐ¾Ñ†ÑÐµÑ‚Ð¸': 'social'
        }

        action = None
        for key, value in marketing_actions.items():
            if key in description:
                action = value
                break

        responses = {
            'campaign': lambda: "ÐœÐ°Ñ€ÐºÐµÑ‚Ð¸Ð½Ð³Ð¾Ð²Ð°Ñ ÐºÐ°Ð¼Ð¿Ð°Ð½Ð¸Ñ:\n" + \
                            "ÐšÐ°Ð½Ð°Ð»Ñ‹: Digital, SMM, Email\n" + \
                            "Ð‘ÑŽÐ´Ð¶ÐµÑ‚: " + self._format_currency(150000) + " Ñ€ÑƒÐ±.\n" + \
                            "Ð”Ð»Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ: 3 Ð¼ÐµÑÑÑ†Ð°\n" + \
                            "ÐžÑ…Ð²Ð°Ñ‚: 50,000 Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹",
            'analysis': lambda: "ÐÐ½Ð°Ð»Ð¸Ð· Ñ€Ñ‹Ð½ÐºÐ°:\n" + \
                            "Ð Ð°Ð·Ð¼ÐµÑ€ Ñ€Ñ‹Ð½ÐºÐ°: " + self._format_currency(1500000000) + " Ñ€ÑƒÐ±.\n" + \
                            "Ð Ð¾ÑÑ‚: 15% Ð² Ð³Ð¾Ð´\n" + \
                            "ÐšÐ¾Ð½ÐºÑƒÑ€ÐµÐ½Ñ‚Ñ‹: 12 Ð¾ÑÐ½Ð¾Ð²Ð½Ñ‹Ñ…\n" + \
                            "Ð”Ð¾Ð»Ñ Ñ€Ñ‹Ð½ÐºÐ°: 8%",
            'promotion': lambda: "ÐŸÐ»Ð°Ð½ Ð¿Ñ€Ð¾Ð´Ð²Ð¸Ð¶ÐµÐ½Ð¸Ñ:\n" + \
                             "ÐšÐ°Ð½Ð°Ð»Ñ‹: 5 Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ñ…\n" + \
                             "ÐšÐ¾Ð½Ð²ÐµÑ€ÑÐ¸Ñ: 2.5%\n" + \
                             "ROI: 185%\n" + \
                             "ÐÐ¾Ð²Ñ‹Ðµ Ð»Ð¸Ð´Ñ‹: 250",
            'strategy': lambda: "ÐœÐ°Ñ€ÐºÐµÑ‚Ð¸Ð½Ð³Ð¾Ð²Ð°Ñ ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ñ:\n" + \
                             "Ð¢Ð¸Ð¿: ÐžÐ¼Ð½Ð¸ÐºÐ°Ð½Ð°Ð»ÑŒÐ½Ð°Ñ\n" + \
                             "Ð¦ÐµÐ»ÐµÐ²Ð°Ñ Ð°ÑƒÐ´Ð¸Ñ‚Ð¾Ñ€Ð¸Ñ: B2B\n" + \
                             "ÐšÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ðµ Ð¼ÐµÑ‚Ñ€Ð¸ÐºÐ¸: CAC, LTV, ROI\n" + \
                             "ÐšÐ°Ð½Ð°Ð»Ñ‹: Digital, Offline, PR",
            'brand': lambda: "Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð±Ñ€ÐµÐ½Ð´Ð¾Ð¼:\n" + \
                          "Ð£Ð·Ð½Ð°Ð²Ð°ÐµÐ¼Ð¾ÑÑ‚ÑŒ: 65%\n" + \
                          "Ð’Ð¾ÑÐ¿Ñ€Ð¸ÑÑ‚Ð¸Ðµ: ÐŸÐ¾Ð·Ð¸Ñ‚Ð¸Ð²Ð½Ð¾Ðµ\n" + \
                          "NPS: 75\n" + \
                          "ÐÐ´Ð²Ð¾ÐºÐ°Ñ‚Ñ‹ Ð±Ñ€ÐµÐ½Ð´Ð°: 2,500",
            'social': lambda: "Ð¡Ð¾Ñ†Ð¸Ð°Ð»ÑŒÐ½Ñ‹Ðµ ÑÐµÑ‚Ð¸:\n" + \
                           "ÐŸÐ¾Ð´Ð¿Ð¸ÑÑ‡Ð¸ÐºÐ¸: 50,000\n" + \
                           "Ð’Ð¾Ð²Ð»ÐµÑ‡ÐµÐ½Ð½Ð¾ÑÑ‚ÑŒ: 4.8%\n" + \
                           "ÐžÑ…Ð²Ð°Ñ‚: 150,000\n" + \
                           "Ð›Ð¸Ð´Ñ‹: 180 Ð² Ð¼ÐµÑÑÑ†"
        }

        return responses.get(action or 'unknown', lambda: "ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»Ð¸Ñ‚ÑŒ Ñ‚Ð¸Ð¿ Ð¼Ð°Ñ€ÐºÐµÑ‚Ð¸Ð½Ð³Ð¾Ð²Ð¾Ð¹ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸. ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, ÑƒÑ‚Ð¾Ñ‡Ð½Ð¸Ñ‚Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ.")()

    def handle_client(self, entities: Dict) -> str:
        """Handle client-related commands"""
        description = entities.get('description', '').lower()
        if not description:
            return "ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, ÑƒÑ‚Ð¾Ñ‡Ð½Ð¸Ñ‚Ðµ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸ÑŽ Ñ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°Ð¼Ð¸"

        client_actions = {
            'Ð±Ð°Ð·Ð°': 'database',
            'ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ°': 'statistics',
            'Ð»Ð¾ÑÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ': 'loyalty',
            'Ð¾Ð±Ñ€Ð°Ñ‚Ð½Ð°Ñ ÑÐ²ÑÐ·ÑŒ': 'feedback',
            'ÑÐµÐ³Ð¼ÐµÐ½Ñ‚': 'segment',
            'Ð¸ÑÑ‚Ð¾Ñ€Ð¸Ñ': 'history'
        }

        action = None
        for key, value in client_actions.items():
            if key in description:
                action = value
                break

        responses = {
            'database': lambda: "Ð‘Ð°Ð·Ð° ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¾Ð²:\n" + \
                             "Ð’ÑÐµÐ³Ð¾ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¾Ð²: 1,500\n" + \
                             "ÐÐºÑ‚Ð¸Ð²Ð½Ñ‹Ñ…: 850\n" + \
                             "ÐÐ¾Ð²Ñ‹Ñ… Ð·Ð° Ð¼ÐµÑÑÑ†: 45\n" + \
                             "Ð¡Ñ€ÐµÐ´Ð½Ð¸Ð¹ Ñ‡ÐµÐº: " + self._format_currency(25000) + " Ñ€ÑƒÐ±.",
            'statistics': lambda: "Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° Ð¿Ð¾ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°Ð¼:\n" + \
                               "Ð£Ð´ÐµÑ€Ð¶Ð°Ð½Ð¸Ðµ: 85%\n" + \
                               "Ð¡Ñ€ÐµÐ´Ð½Ð¸Ð¹ LTV: " + self._format_currency(120000) + " Ñ€ÑƒÐ±.\n" + \
                               "CAC: " + self._format_currency(15000) + " Ñ€ÑƒÐ±.\n" + \
                               "Ð¡Ñ€Ð¾Ðº Ð¶Ð¸Ð·Ð½Ð¸: 24 Ð¼ÐµÑÑÑ†Ð°",
            'loyalty': lambda: "ÐŸÑ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð° Ð»Ð¾ÑÐ»ÑŒÐ½Ð¾ÑÑ‚Ð¸:\n" + \
                            "Ð£Ñ‡Ð°ÑÑ‚Ð½Ð¸ÐºÐ¾Ð²: 750\n" + \
                            "ÐÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ: 65%\n" + \
                            "Ð¡Ñ€ÐµÐ´Ð½Ð¸Ð¹ Ð±Ð¾Ð½ÑƒÑ: " + self._format_currency(2500) + " Ñ€ÑƒÐ±.\n" + \
                            "ÐžÐºÑƒÐ¿Ð°ÐµÐ¼Ð¾ÑÑ‚ÑŒ: 185%",
            'feedback': lambda: "ÐžÐ±Ñ€Ð°Ñ‚Ð½Ð°Ñ ÑÐ²ÑÐ·ÑŒ:\n" + \
                             "NPS: 75\n" + \
                             "CSAT: 4.8/5\n" + \
                             "ÐžÑ‚Ð·Ñ‹Ð²Ð¾Ð² Ð·Ð° Ð¼ÐµÑÑÑ†: 125\n" + \
                             "ÐŸÑ€Ð¾Ñ†ÐµÐ½Ñ‚ Ñ€ÐµÑˆÑ‘Ð½Ð½Ñ‹Ñ… Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼: 95%",
            'segment': lambda: "Ð¡ÐµÐ³Ð¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¾Ð²:\n" + \
                            "Premium: 15%\n" + \
                            "Business: 45%\n" + \
                            "Standard: 40%\n" + \
                            "ÐŸÐ¾Ñ‚ÐµÐ½Ñ†Ð¸Ð°Ð» Ñ€Ð¾ÑÑ‚Ð°: 25%",
            'history': lambda: "Ð˜ÑÑ‚Ð¾Ñ€Ð¸Ñ Ð²Ð·Ð°Ð¸Ð¼Ð¾Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹:\n" + \
                            "Ð’ÑÐµÐ³Ð¾ ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ð¾Ð²: 2,500\n" + \
                            "Ð¡Ñ€ÐµÐ´Ð½ÐµÐµ Ð²Ñ€ÐµÐ¼Ñ Ð¾Ñ‚Ð²ÐµÑ‚Ð°: 2.5 Ñ‡Ð°ÑÐ°\n" + \
                            "Ð£ÑÐ¿ÐµÑˆÐ½Ñ‹Ñ… ÑÐ´ÐµÐ»Ð¾Ðº: 85%\n" + \
                            "ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð½Ñ‹Ðµ Ð¾Ð±Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ñ: 45%"
        }

        return responses.get(action or 'unknown', lambda: "ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»Ð¸Ñ‚ÑŒ Ñ‚Ð¸Ð¿ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸ Ñ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°Ð¼Ð¸. ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, ÑƒÑ‚Ð¾Ñ‡Ð½Ð¸Ñ‚Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ.")()

    def handle_supplier(self, entities: Dict) -> str:
        """Handle supplier-related commands"""
        description = entities.get('description', '').lower()
        if not description:
            return "ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, ÑƒÑ‚Ð¾Ñ‡Ð½Ð¸Ñ‚Ðµ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸ÑŽ Ñ Ð¿Ð¾ÑÑ‚Ð°Ð²Ñ‰Ð¸ÐºÐ°Ð¼Ð¸"

        supplier_actions = {
            'ÑÐ¿Ð¸ÑÐ¾Ðº': 'list',
            'Ð¾Ñ†ÐµÐ½ÐºÐ°': 'evaluation',
            'Ð·Ð°ÐºÐ°Ð·': 'order',
            'ÐºÐ¾Ð½Ñ‚Ñ€Ð°ÐºÑ‚': 'contract',
            'Ð¸ÑÑ‚Ð¾Ñ€Ð¸Ñ': 'history',
            'ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ°': 'statistics'
        }

        action = None
        for key, value in supplier_actions.items():
            if key in description:
                action = value
                break

        responses = {
            'list': lambda: "Ð¡Ð¿Ð¸ÑÐ¾Ðº Ð¿Ð¾ÑÑ‚Ð°Ð²Ñ‰Ð¸ÐºÐ¾Ð²:\n" + \
                         "ÐÐºÑ‚Ð¸Ð²Ð½Ñ‹Ñ…: 25\n" + \
                         "ÐÐ¾Ð²Ñ‹Ñ…: 3\n" + \
                         "ÐÐ° Ñ€Ð°ÑÑÐ¼Ð¾Ñ‚Ñ€ÐµÐ½Ð¸Ð¸: 5\n" + \
                         "Ð—Ð°Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ñ…: 2",
            'evaluation': lambda: "ÐžÑ†ÐµÐ½ÐºÐ° Ð¿Ð¾ÑÑ‚Ð°Ð²Ñ‰Ð¸ÐºÐ¾Ð²:\n" + \
                               "ÐšÐ°Ñ‡ÐµÑÑ‚Ð²Ð¾: 4.8/5\n" + \
                               "Ð¡Ð²Ð¾ÐµÐ²Ñ€ÐµÐ¼ÐµÐ½Ð½Ð¾ÑÑ‚ÑŒ: 95%\n" + \
                               "Ð¦ÐµÐ½Ð¾Ð²Ð°Ñ Ð¿Ð¾Ð»Ð¸Ñ‚Ð¸ÐºÐ°: 4.5/5\n" + \
                               "ÐÐ°Ð´Ñ‘Ð¶Ð½Ð¾ÑÑ‚ÑŒ: 4.7/5",
            'order': lambda: "Ð¡Ñ‚Ð°Ñ‚ÑƒÑ Ð·Ð°ÐºÐ°Ð·Ð¾Ð²:\n" + \
                          "Ð’ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐµ: 12\n" + \
                          "ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¾: 8\n" + \
                          "ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¾: 15\n" + \
                          "ÐžÐ±Ñ‰Ð°Ñ ÑÑƒÐ¼Ð¼Ð°: " + self._format_currency(750000) + " Ñ€ÑƒÐ±.",
            'contract': lambda: "ÐšÐ¾Ð½Ñ‚Ñ€Ð°ÐºÑ‚Ñ‹ Ñ Ð¿Ð¾ÑÑ‚Ð°Ð²Ñ‰Ð¸ÐºÐ°Ð¼Ð¸:\n" + \
                             "ÐÐºÑ‚Ð¸Ð²Ð½Ñ‹Ñ…: 18\n" + \
                             "ÐÐ° Ð¿Ð¾Ð´Ð¿Ð¸ÑÐ°Ð½Ð¸Ð¸: 3\n" + \
                             "Ð˜ÑÑ‚ÐµÐºÐ°ÑŽÑ‚ Ð² ÑÑ‚Ð¾Ð¼ Ð¼ÐµÑÑÑ†Ðµ: 2\n" + \
                             "Ð¢Ñ€ÐµÐ±ÑƒÑŽÑ‚ Ð¿Ñ€Ð¾Ð´Ð»ÐµÐ½Ð¸Ñ: 4",
            'history': lambda: "Ð˜ÑÑ‚Ð¾Ñ€Ð¸Ñ Ð¿Ð¾ÑÑ‚Ð°Ð²Ð¾Ðº:\n" + \
                            "Ð’ÑÐµÐ³Ð¾ Ð¿Ð¾ÑÑ‚Ð°Ð²Ð¾Ðº: 150\n" + \
                            "Ð’Ð¾Ð²Ñ€ÐµÐ¼Ñ: 142\n" + \
                            "Ð¡ Ð·Ð°Ð´ÐµÑ€Ð¶ÐºÐ¾Ð¹: 8\n" + \
                            "Ð¡Ñ€ÐµÐ´Ð½ÐµÐµ Ð²Ñ€ÐµÐ¼Ñ Ð´Ð¾ÑÑ‚Ð°Ð²ÐºÐ¸: 5 Ð´Ð½ÐµÐ¹",
            'statistics': lambda: "Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° Ð¿Ð¾ÑÑ‚Ð°Ð²Ñ‰Ð¸ÐºÐ¾Ð²:\n" + \
                                "Ð¡Ñ€ÐµÐ´Ð½Ð¸Ð¹ ÑÑ€Ð¾Ðº ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸Ñ‡ÐµÑÑ‚Ð²Ð°: 2.5 Ð³Ð¾Ð´Ð°\n" + \
                                "ÐŸÑ€Ð¾Ñ†ÐµÐ½Ñ‚ Ð±Ñ€Ð°ÐºÐ°: 0.5%\n" + \
                                "ÐŸÑ€Ð¾Ñ†ÐµÐ½Ñ‚ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚Ð¾Ð²: 1.2%\n" + \
                                "Ð­ÐºÐ¾Ð½Ð¾Ð¼Ð¸Ñ Ð½Ð° Ð·Ð°ÐºÑƒÐ¿ÐºÐ°Ñ…: 15%"
        }

        return responses.get(action or 'unknown', lambda: "ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»Ð¸Ñ‚ÑŒ Ñ‚Ð¸Ð¿ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸ Ñ Ð¿Ð¾ÑÑ‚Ð°Ð²Ñ‰Ð¸ÐºÐ°Ð¼Ð¸. ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, ÑƒÑ‚Ð¾Ñ‡Ð½Ð¸Ñ‚Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ.")()

    def handle_contract(self, entities: Dict) -> str:
        """Handle contract-related commands"""
        description = entities.get('description', '').lower()
        if not description:
            return "ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, ÑƒÑ‚Ð¾Ñ‡Ð½Ð¸Ñ‚Ðµ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸ÑŽ Ñ Ð´Ð¾Ð³Ð¾Ð²Ð¾Ñ€Ð°Ð¼Ð¸"

        contract_actions = {
            'ÑÑ‚Ð°Ñ‚ÑƒÑ': 'status',
            'ÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ': 'create',
            'Ð¸Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ': 'modify',
            'Ð¿Ñ€Ð¾Ð´Ð»Ð¸Ñ‚ÑŒ': 'extend',
            'Ñ€Ð°ÑÑ‚Ð¾Ñ€Ð³Ð½ÑƒÑ‚ÑŒ': 'terminate',
            'Ð°Ñ€Ñ…Ð¸Ð²': 'archive'
        }

        action = None
        for key, value in contract_actions.items():
            if key in description:
                action = value
                break

        responses = {
            'status': lambda: "Ð¡Ñ‚Ð°Ñ‚ÑƒÑ Ð´Ð¾Ð³Ð¾Ð²Ð¾Ñ€Ð¾Ð²:\n" + \
                           "ÐÐºÑ‚Ð¸Ð²Ð½Ñ‹Ñ…: 45\n" + \
                           "ÐÐ° ÑÐ¾Ð³Ð»Ð°ÑÐ¾Ð²Ð°Ð½Ð¸Ð¸: 8\n" + \
                           "Ð¢Ñ€ÐµÐ±ÑƒÑŽÑ‚ Ð¿Ñ€Ð¾Ð´Ð»ÐµÐ½Ð¸Ñ: 5\n" + \
                           "ÐŸÑ€Ð¾ÑÑ€Ð¾Ñ‡ÐµÐ½Ð½Ñ‹Ñ…: 2",
            'create': lambda: "Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð´Ð¾Ð³Ð¾Ð²Ð¾Ñ€Ð°:\n" + \
                           "ÐÐ¾Ð¼ÐµÑ€: CTR-2024-001\n" + \
                           "Ð¢Ð¸Ð¿: Ð¡Ñ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ñ‹Ð¹\n" + \
                           "Ð¡Ñ€Ð¾Ðº: 12 Ð¼ÐµÑÑÑ†ÐµÐ²\n" + \
                           "Ð¡Ñ‚Ð°Ñ‚ÑƒÑ: ÐÐ° ÑÐ¾Ð³Ð»Ð°ÑÐ¾Ð²Ð°Ð½Ð¸Ð¸",
            'modify': lambda: "Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ð´Ð¾Ð³Ð¾Ð²Ð¾Ñ€Ð°:\n" + \
                           "Ð’Ð½ÐµÑÐµÐ½Ð¾ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹: 3\n" + \
                           "Ð¢ÐµÐºÑƒÑ‰Ð°Ñ Ð²ÐµÑ€ÑÐ¸Ñ: 2.1\n" + \
                           "Ð¡Ð¾Ð³Ð»Ð°ÑÐ¾Ð²Ð°Ð½Ð¾: Ð®Ñ€.Ð¾Ñ‚Ð´ÐµÐ»\n" + \
                           "ÐžÐ¶Ð¸Ð´Ð°ÐµÑ‚ Ð¿Ð¾Ð´Ð¿Ð¸ÑÐ°Ð½Ð¸Ñ",
            'extend': lambda: "ÐŸÑ€Ð¾Ð´Ð»ÐµÐ½Ð¸Ðµ Ð´Ð¾Ð³Ð¾Ð²Ð¾Ñ€Ð°:\n" + \
                           "ÐÐ¾Ð²Ñ‹Ð¹ ÑÑ€Ð¾Ðº: +12 Ð¼ÐµÑÑÑ†ÐµÐ²\n" + \
                           "Ð£ÑÐ»Ð¾Ð²Ð¸Ñ: Ð‘ÐµÐ· Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹\n" + \
                           "Ð¢Ñ€ÐµÐ±ÑƒÐµÐ¼Ñ‹Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ: ÐŸÐ¾Ð´Ð¿Ð¸ÑÐ°Ð½Ð¸Ðµ Ð´Ð¾Ð¿.ÑÐ¾Ð³Ð»Ð°ÑˆÐµÐ½Ð¸Ñ",
            'terminate': lambda: "Ð Ð°ÑÑ‚Ð¾Ñ€Ð¶ÐµÐ½Ð¸Ðµ Ð´Ð¾Ð³Ð¾Ð²Ð¾Ñ€Ð°:\n" + \
                              "ÐŸÑ€Ð¸Ñ‡Ð¸Ð½Ð°: ÐŸÐ¾ ÑÐ¾Ð³Ð»Ð°ÑˆÐµÐ½Ð¸ÑŽ ÑÑ‚Ð¾Ñ€Ð¾Ð½\n" + \
                              "Ð”Ð°Ñ‚Ð°: 31.12.2024\n" + \
                              "Ð¢Ñ€ÐµÐ±ÑƒÐµÐ¼Ñ‹Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ: ÐŸÐ¾Ð´Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐ° ÑÐ¾Ð³Ð»Ð°ÑˆÐµÐ½Ð¸Ñ",
            'archive': lambda: "ÐÑ€Ñ…Ð¸Ð² Ð´Ð¾Ð³Ð¾Ð²Ð¾Ñ€Ð¾Ð²:\n" + \
                            "Ð’ÑÐµÐ³Ð¾: 250\n" + \
                            "Ð—Ð° Ñ‚ÐµÐºÑƒÑ‰Ð¸Ð¹ Ð³Ð¾Ð´: 45\n" + \
                            "Ð£ÑÐ¿ÐµÑˆÐ½Ð¾ Ð·Ð°Ð²ÐµÑ€ÑˆÑ‘Ð½Ð½Ñ‹Ñ…: 225\n" + \
                            "Ð”Ð¾ÑÑ€Ð¾Ñ‡Ð½Ð¾ Ñ€Ð°ÑÑ‚Ð¾Ñ€Ð³Ð½ÑƒÑ‚Ñ‹Ñ…: 25"
        }

        return responses.get(action or 'unknown', lambda: "ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»Ð¸Ñ‚ÑŒ Ñ‚Ð¸Ð¿ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸ Ñ Ð´Ð¾Ð³Ð¾Ð²Ð¾Ñ€Ð°Ð¼Ð¸. ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, ÑƒÑ‚Ð¾Ñ‡Ð½Ð¸Ñ‚Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ.")()

    def handle_quality(self, entities: Dict) -> str:
        """Handle quality management commands"""
        description = entities.get('description', '').lower()
        if not description:
            return "ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, ÑƒÑ‚Ð¾Ñ‡Ð½Ð¸Ñ‚Ðµ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸ÑŽ Ñ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð¾Ð¼"

        quality_actions = {
            'Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ°': 'check',
            'ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÑŒ': 'control',
            'ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ñ‹': 'standards',
            'ÑƒÐ»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ðµ': 'improvement',
            'Ð¾Ñ‚Ñ‡ÐµÑ‚': 'report',
            'Ð¼ÐµÑ‚Ñ€Ð¸ÐºÐ¸': 'metrics'
        }

        action = None
        for key, value in quality_actions.items():
            if key in description:
                action = value
                break

        responses = {
            'check': lambda: "ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð°:\n" + \
                          "Ð¡Ð¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ðµ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð°Ð¼: 98%\n" + \
                          "Ð’Ñ‹ÑÐ²Ð»ÐµÐ½Ð¾ Ð½ÐµÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ð¹: 5\n" + \
                          "ÐšÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ñ…: 0\n" + \
                          "Ð¢Ñ€ÐµÐ±ÑƒÑŽÑ‚ Ð²Ð½Ð¸Ð¼Ð°Ð½Ð¸Ñ: 3",
            'control': lambda: "ÐšÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÑŒ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð°:\n" + \
                            "ÐŸÑ€Ð¾Ð²ÐµÐ´ÐµÐ½Ð¾ Ð¿Ñ€Ð¾Ð²ÐµÑ€Ð¾Ðº: 125\n" + \
                            "ÐŸÑ€Ð¾Ð¹Ð´ÐµÐ½Ð¾: 120\n" + \
                            "ÐÐ° Ð´Ð¾Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐµ: 5\n" + \
                            "Ð­Ñ„Ñ„ÐµÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹: 96%",
            'standards': lambda: "Ð¡Ñ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ñ‹ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð°:\n" + \
                              "Ð’ÑÐµÐ³Ð¾ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð¾Ð²: 45\n" + \
                              "ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¾ Ð² ÑÑ‚Ð¾Ð¼ Ð³Ð¾Ð´Ñƒ: 8\n" + \
                              "ÐÐ° Ð¿ÐµÑ€ÐµÑÐ¼Ð¾Ñ‚Ñ€Ðµ: 3\n" + \
                              "Ð¡Ð¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ðµ ISO: 100%",
            'improvement': lambda: "Ð£Ð»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ðµ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð°:\n" + \
                                "Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ñ‚Ð¸Ð² Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½Ð¾: 12\n" + \
                                "Ð—Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¾: 8\n" + \
                                "Ð’ Ð¿Ñ€Ð¾Ñ†ÐµÑÑÐµ: 4\n" + \
                                "Ð­Ñ„Ñ„ÐµÐºÑ‚: +15% Ðº ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ñƒ",
            'report': lambda: "ÐžÑ‚Ñ‡ÐµÑ‚ Ð¿Ð¾ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ñƒ:\n" + \
                           "ÐžÐ±Ñ‰Ð¸Ð¹ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ: 4.8/5\n" + \
                           "Ð¢Ñ€ÐµÐ½Ð´: ÐŸÐ¾Ð·Ð¸Ñ‚Ð¸Ð²Ð½Ñ‹Ð¹\n" + \
                           "ÐžÑÐ½Ð¾Ð²Ð½Ñ‹Ðµ ÑƒÐ»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ñ: 5\n" + \
                           "Ð­ÐºÐ¾Ð½Ð¾Ð¼Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ ÑÑ„Ñ„ÐµÐºÑ‚: " + self._format_currency(250000) + " Ñ€ÑƒÐ±.",
            'metrics': lambda: "ÐœÐµÑ‚Ñ€Ð¸ÐºÐ¸ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð°:\n" + \
                            "Ð”ÐµÑ„ÐµÐºÑ‚Ñ‹: -25%\n" + \
                            "Ð’Ñ€ÐµÐ¼Ñ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ: -35%\n" + \
                            "Ð£Ð´Ð¾Ð²Ð»ÐµÑ‚Ð²Ð¾Ñ€ÐµÐ½Ð½Ð¾ÑÑ‚ÑŒ: +15%\n" + \
                            "Ð¡Ñ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð°: -10%"
        }

        return responses.get(action or 'unknown', lambda: "ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»Ð¸Ñ‚ÑŒ Ñ‚Ð¸Ð¿ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸ Ñ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð¾Ð¼. ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, ÑƒÑ‚Ð¾Ñ‡Ð½Ð¸Ñ‚Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ.")()

    def handle_risk(self, entities: Dict) -> str:
        """Handle risk management commands"""
        description = entities.get('description', '').lower()
        if not description:
            return "ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, ÑƒÑ‚Ð¾Ñ‡Ð½Ð¸Ñ‚Ðµ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸ÑŽ Ñ Ñ€Ð¸ÑÐºÐ°Ð¼Ð¸"

        risk_actions = {
            'Ð°Ð½Ð°Ð»Ð¸Ð·': 'analysis',
            'Ð¾Ñ†ÐµÐ½ÐºÐ°': 'assessment',
            'Ð¼Ð¸Ñ‚Ð¸Ð³Ð°Ñ†Ð¸Ñ': 'mitigation',
            'Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³': 'monitoring',
            'Ð¾Ñ‚Ñ‡ÐµÑ‚': 'report',
            'Ð¿Ñ€Ð¾Ð³Ð½Ð¾Ð·': 'forecast'
        }

        action = None
        for key, value in risk_actions.items():
            if key in description:
                action = value
                break

        responses = {
            'analysis': lambda: "ÐÐ½Ð°Ð»Ð¸Ð· Ñ€Ð¸ÑÐºÐ¾Ð²:\n" + \
                             "Ð’Ñ‹ÑÐ²Ð»ÐµÐ½Ð¾ Ñ€Ð¸ÑÐºÐ¾Ð²: 25\n" + \
                             "ÐšÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ñ…: 3\n" + \
                             "Ð¡Ñ€ÐµÐ´Ð½Ð¸Ñ…: 12\n" + \
                             "ÐÐ¸Ð·ÐºÐ¸Ñ…: 10",
            'assessment': lambda: "ÐžÑ†ÐµÐ½ÐºÐ° Ñ€Ð¸ÑÐºÐ¾Ð²:\n" + \
                               "Ð¤Ð¸Ð½Ð°Ð½ÑÐ¾Ð²Ñ‹Ðµ: Ð¡Ñ€ÐµÐ´Ð½Ð¸Ð¹ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ\n" + \
                               "ÐžÐ¿ÐµÑ€Ð°Ñ†Ð¸Ð¾Ð½Ð½Ñ‹Ðµ: ÐÐ¸Ð·ÐºÐ¸Ð¹ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ\n" + \
                               "Ð Ñ‹Ð½Ð¾Ñ‡Ð½Ñ‹Ðµ: Ð’Ñ‹ÑÐ¾ÐºÐ¸Ð¹ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ\n" + \
                               "Ð ÐµÐ¿ÑƒÑ‚Ð°Ñ†Ð¸Ð¾Ð½Ð½Ñ‹Ðµ: ÐÐ¸Ð·ÐºÐ¸Ð¹ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ",
            'mitigation': lambda: "ÐœÐ¸Ñ‚Ð¸Ð³Ð°Ñ†Ð¸Ñ Ñ€Ð¸ÑÐºÐ¾Ð²:\n" + \
                               "ÐŸÐ»Ð°Ð½ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹: 15 Ð¼ÐµÑ€\n" + \
                               "Ð ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ð¾: 10\n" + \
                               "Ð’ Ð¿Ñ€Ð¾Ñ†ÐµÑÑÐµ: 5\n" + \
                               "Ð­Ñ„Ñ„ÐµÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ: 85%",
            'monitoring': lambda: "ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³ Ñ€Ð¸ÑÐºÐ¾Ð²:\n" + \
                               "ÐŸÐ¾Ð´ Ð½Ð°Ð±Ð»ÑŽÐ´ÐµÐ½Ð¸ÐµÐ¼: 20\n" + \
                               "Ð¢Ñ€ÐµÐ±ÑƒÑŽÑ‚ Ð²Ð½Ð¸Ð¼Ð°Ð½Ð¸Ñ: 5\n" + \
                               "Ð§Ð°ÑÑ‚Ð¾Ñ‚Ð° Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸: Ð•Ð¶ÐµÐ½ÐµÐ´ÐµÐ»ÑŒÐ½Ð¾\n" + \
                               "Ð¢Ñ€ÐµÐ½Ð´: Ð¡Ñ‚Ð°Ð±Ð¸Ð»ÑŒÐ½Ñ‹Ð¹",
            'report': lambda: "ÐžÑ‚Ñ‡ÐµÑ‚ Ð¿Ð¾ Ñ€Ð¸ÑÐºÐ°Ð¼:\n" + \
                           "ÐžÐ±Ñ‰Ð¸Ð¹ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ: Ð£Ð¼ÐµÑ€ÐµÐ½Ð½Ñ‹Ð¹\n" + \
                           "Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ð·Ð° Ð¿ÐµÑ€Ð¸Ð¾Ð´: -15%\n" + \
                           "ÐÐ¾Ð²Ñ‹Ðµ Ñ€Ð¸ÑÐºÐ¸: 3\n" + \
                           "Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ Ñ€Ð¸ÑÐºÐ¸: 5",
            'forecast': lambda: "ÐŸÑ€Ð¾Ð³Ð½Ð¾Ð· Ñ€Ð¸ÑÐºÐ¾Ð²:\n" + \
                             "ÐšÑ€Ð°Ñ‚ÐºÐ¾ÑÑ€Ð¾Ñ‡Ð½Ñ‹Ð¹: Ð¡Ñ‚Ð°Ð±Ð¸Ð»ÑŒÐ½Ñ‹Ð¹\n" + \
                             "Ð¡Ñ€ÐµÐ´Ð½ÐµÑÑ€Ð¾Ñ‡Ð½Ñ‹Ð¹: Ð£Ð¼ÐµÑ€ÐµÐ½Ð½Ñ‹Ð¹ Ñ€Ð¾ÑÑ‚\n" + \
                             "ÐšÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð¾Ð±Ð»Ð°ÑÑ‚Ð¸: 2\n" + \
                             "Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸: 8"
        }

        return responses.get(action or 'unknown', lambda: "ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»Ð¸Ñ‚ÑŒ Ñ‚Ð¸Ð¿ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸ Ñ Ñ€Ð¸ÑÐºÐ°Ð¼Ð¸. ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, ÑƒÑ‚Ð¾Ñ‡Ð½Ð¸Ñ‚Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ.")()

    def handle_strategy(self, entities: Dict) -> str:
        """Handle strategy management commands"""
        description = entities.get('description', '').lower()
        if not description:
            return "ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, ÑƒÑ‚Ð¾Ñ‡Ð½Ð¸Ñ‚Ðµ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸ÑŽ ÑÐ¾ ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸ÐµÐ¹"

        strategy_actions = {
            'Ñ†ÐµÐ»Ð¸': 'goals',
            'Ð°Ð½Ð°Ð»Ð¸Ð·': 'analysis',
            'Ð¿Ð»Ð°Ð½': 'plan',
            'Ñ€Ð°Ð·Ð²Ð¸Ñ‚Ð¸Ðµ': 'development',
            'Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹': 'results',
            'ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð¸Ñ€Ð¾Ð²ÐºÐ°': 'adjustment'
        }

        action = None
        for key, value in strategy_actions.items():
            if key in description:
                action = value
                break

        responses = {
            'goals': lambda: "Ð¡Ñ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ñ†ÐµÐ»Ð¸:\n" + \
                          "ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾: 5\n" + \
                          "Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¾: 2\n" + \
                          "Ð’ Ð¿Ñ€Ð¾Ñ†ÐµÑÑÐµ: 3\n" + \
                          "ÐŸÑ€Ð¾Ð³Ñ€ÐµÑÑ: 65%",
            'analysis': lambda: "Ð¡Ñ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð°Ð½Ð°Ð»Ð¸Ð·:\n" + \
                             "SWOT: ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½\n" + \
                             "ÐšÐ¾Ð½ÐºÑƒÑ€ÐµÐ½Ñ‚Ð½Ñ‹Ð¹ Ð°Ð½Ð°Ð»Ð¸Ð·: ÐÐºÑ‚ÑƒÐ°Ð»ÐµÐ½\n" + \
                             "Ð Ñ‹Ð½Ð¾Ñ‡Ð½Ñ‹Ðµ Ñ‚Ñ€ÐµÐ½Ð´Ñ‹: +5 Ð½Ð¾Ð²Ñ‹Ñ…\n" + \
                             "Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸: 12",
            'plan': lambda: "Ð¡Ñ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð¿Ð»Ð°Ð½:\n" + \
                         "Ð“Ð¾Ñ€Ð¸Ð·Ð¾Ð½Ñ‚: 3 Ð³Ð¾Ð´Ð°\n" + \
                         "ÐšÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ðµ Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ñ‚Ð¸Ð²Ñ‹: 8\n" + \
                         "Ð‘ÑŽÐ´Ð¶ÐµÑ‚: " + self._format_currency(15000000) + " Ñ€ÑƒÐ±.\n" + \
                         "Ð Ð¸ÑÐºÐ¸: Ð£Ð¼ÐµÑ€ÐµÐ½Ð½Ñ‹Ðµ",
            'development': lambda: "Ð Ð°Ð·Ð²Ð¸Ñ‚Ð¸Ðµ Ð±Ð¸Ð·Ð½ÐµÑÐ°:\n" + \
                                "ÐÐ¾Ð²Ñ‹Ðµ Ð½Ð°Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ: 3\n" + \
                                "Ð Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð¸Ðµ: 2 Ñ€ÐµÐ³Ð¸Ð¾Ð½Ð°\n" + \
                                "Ð˜Ð½Ð²ÐµÑÑ‚Ð¸Ñ†Ð¸Ð¸: " + self._format_currency(5000000) + " Ñ€ÑƒÐ±.\n" + \
                                "ROI Ð¿Ñ€Ð¾Ð³Ð½Ð¾Ð·: 185%",
            'results': lambda: "Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ð¸:\n" + \
                            "Ð”Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ðµ Ñ†ÐµÐ»ÐµÐ¹: 75%\n" + \
                            "Ð Ð¾ÑÑ‚ Ð²Ñ‹Ñ€ÑƒÑ‡ÐºÐ¸: +25%\n" + \
                            "Ð”Ð¾Ð»Ñ Ñ€Ñ‹Ð½ÐºÐ°: +5%\n" + \
                            "Ð­Ñ„Ñ„ÐµÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ: Ð’Ñ‹ÑÐ¾ÐºÐ°Ñ",
            'adjustment': lambda: "ÐšÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð¸Ñ€Ð¾Ð²ÐºÐ° ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ð¸:\n" + \
                               "Ð’Ð½ÐµÑÐµÐ½Ð¾ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹: 4\n" + \
                               "ÐŸÑ€Ð¸Ñ‡Ð¸Ð½Ñ‹: Ð Ñ‹Ð½Ð¾Ñ‡Ð½Ñ‹Ðµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ\n" + \
                               "Ð’Ð»Ð¸ÑÐ½Ð¸Ðµ: Ð£Ð¼ÐµÑ€ÐµÐ½Ð½Ð¾Ðµ\n" + \
                               "Ð¡Ñ‚Ð°Ñ‚ÑƒÑ: ÐÐ° ÑƒÑ‚Ð²ÐµÑ€Ð¶Ð´ÐµÐ½Ð¸Ð¸"
        }

        return responses.get(action or 'unknown', lambda: "ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»Ð¸Ñ‚ÑŒ Ñ‚Ð¸Ð¿ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸ ÑÐ¾ ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸ÐµÐ¹. ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, ÑƒÑ‚Ð¾Ñ‡Ð½Ð¸Ñ‚Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ.")()

    def handle_compliance(self, entities: Dict) -> str:
        """Handle compliance management commands"""
        description = entities.get('description', '').lower()
        if not description:
            return "ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, ÑƒÑ‚Ð¾Ñ‡Ð½Ð¸Ñ‚Ðµ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸ÑŽ Ñ ÐºÐ¾Ð¼Ð¿Ð»Ð°ÐµÐ½Ñ"

        compliance_actions = {
            'Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ°': 'audit',
            'Ñ‚Ñ€ÐµÐ±Ð¾Ð²Ð°Ð½Ð¸Ñ': 'requirements',
            'Ð¾Ñ‚Ñ‡ÐµÑ‚': 'report',
            'Ñ€Ð¸ÑÐºÐ¸': 'risks',
            'Ð¾Ð±ÑƒÑ‡ÐµÐ½Ð¸Ðµ': 'training',
            'Ð½Ð°Ñ€ÑƒÑˆÐµÐ½Ð¸Ñ': 'violations'
        }

        action = None
        for key, value in compliance_actions.items():
            if key in description:
                action = value
                break

        responses = {
            'audit': lambda: "ÐÑƒÐ´Ð¸Ñ‚ ÐºÐ¾Ð¼Ð¿Ð»Ð°ÐµÐ½Ñ:\n" + \
                          "ÐŸÑ€Ð¾Ð²ÐµÑ€ÐµÐ½Ð¾ Ð¿Ñ€Ð¾Ñ†ÐµÑÑÐ¾Ð²: 25\n" + \
                          "Ð¡Ð¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚: 22\n" + \
                          "Ð¢Ñ€ÐµÐ±ÑƒÐµÑ‚ ÑƒÐ»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ñ: 3\n" + \
                          "ÐšÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ñ… Ð½Ð°Ñ€ÑƒÑˆÐµÐ½Ð¸Ð¹: 0",
            'requirements': lambda: "Ð¢Ñ€ÐµÐ±Ð¾Ð²Ð°Ð½Ð¸Ñ ÐºÐ¾Ð¼Ð¿Ð»Ð°ÐµÐ½Ñ:\n" + \
                                "Ð’ÑÐµÐ³Ð¾ Ñ‚Ñ€ÐµÐ±Ð¾Ð²Ð°Ð½Ð¸Ð¹: 85\n" + \
                                "Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ÑÑ: 82\n" + \
                                "ÐÐ° Ð´Ð¾Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐµ: 3\n" + \
                                "ÐÐ¾Ð²Ñ‹Ñ…: 5",
            'report': lambda: "ÐžÑ‚Ñ‡ÐµÑ‚ Ð¿Ð¾ ÐºÐ¾Ð¼Ð¿Ð»Ð°ÐµÐ½Ñ:\n" + \
                           "ÐžÐ±Ñ‰Ð¸Ð¹ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ: Ð’Ñ‹ÑÐ¾ÐºÐ¸Ð¹\n" + \
                           "Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ: +5%\n" + \
                           "ÐžÑÐ½Ð¾Ð²Ð½Ñ‹Ðµ ÑƒÐ»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ñ: 8\n" + \
                           "ÐžÐ±Ð»Ð°ÑÑ‚Ð¸ Ñ€Ð°Ð·Ð²Ð¸Ñ‚Ð¸Ñ: 3",
            'risks': lambda: "ÐšÐ¾Ð¼Ð¿Ð»Ð°ÐµÐ½Ñ-Ñ€Ð¸ÑÐºÐ¸:\n" + \
                          "Ð’Ñ‹ÑÐ²Ð»ÐµÐ½Ð¾: 15\n" + \
                          "Ð£ÑÑ‚Ñ€Ð°Ð½ÐµÐ½Ð¾: 12\n" + \
                          "Ð’ Ñ€Ð°Ð±Ð¾Ñ‚Ðµ: 3\n" + \
                          "ÐŸÑ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚Ð½Ñ‹Ðµ: 2",
            'training': lambda: "ÐžÐ±ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð¿Ð¾ ÐºÐ¾Ð¼Ð¿Ð»Ð°ÐµÐ½Ñ:\n" + \
                             "ÐŸÑ€Ð¾Ð²ÐµÐ´ÐµÐ½Ð¾ ÑÐµÑÑÐ¸Ð¹: 12\n" + \
                             "ÐžÐ±ÑƒÑ‡ÐµÐ½Ð¾ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ¾Ð²: 150\n" + \
                             "Ð­Ñ„Ñ„ÐµÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ: 95%\n" + \
                             "ÐŸÐ»Ð°Ð½Ð¸Ñ€ÑƒÐµÑ‚ÑÑ: 3 ÐºÑƒÑ€ÑÐ°",
            'violations': lambda: "ÐÐ°Ñ€ÑƒÑˆÐµÐ½Ð¸Ñ ÐºÐ¾Ð¼Ð¿Ð»Ð°ÐµÐ½Ñ:\n" + \
                               "Ð’ÑÐµÐ³Ð¾ Ð²Ñ‹ÑÐ²Ð»ÐµÐ½Ð¾: 8\n" + \
                               "Ð£ÑÑ‚Ñ€Ð°Ð½ÐµÐ½Ð¾: 7\n" + \
                               "Ð’ Ð¿Ñ€Ð¾Ñ†ÐµÑÑÐµ: 1\n" + \
                               "ÐŸÑ€ÐµÐ²ÐµÐ½Ñ‚Ð¸Ð²Ð½Ñ‹Ðµ Ð¼ÐµÑ€Ñ‹: 5"
        }

        return responses.get(action or 'unknown', lambda: "ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»Ð¸Ñ‚ÑŒ Ñ‚Ð¸Ð¿ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸ Ñ ÐºÐ¾Ð¼Ð¿Ð»Ð°ÐµÐ½Ñ. ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, ÑƒÑ‚Ð¾Ñ‡Ð½Ð¸Ñ‚Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ.")()

    def handle_innovation(self, entities: Dict) -> str:
        """Handle innovation management commands"""
        description = entities.get('description', '').lower()
        if not description:
            return "ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, ÑƒÑ‚Ð¾Ñ‡Ð½Ð¸Ñ‚Ðµ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸ÑŽ Ñ Ð¸Ð½Ð½Ð¾Ð²Ð°Ñ†Ð¸ÑÐ¼Ð¸"

        innovation_actions = {
            'Ð¿Ñ€Ð¾ÐµÐºÑ‚Ñ‹': 'projects',
            'Ð¸Ð´ÐµÐ¸': 'ideas',
            'ÑÑ‚Ð°Ñ‚ÑƒÑ': 'status',
            'Ñ‚ÐµÑ…Ð½Ð¾Ð»Ð¾Ð³Ð¸Ð¸': 'technologies',
            'Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹': 'results',
            'Ð±ÑŽÐ´Ð¶ÐµÑ‚': 'budget'
        }

        action = None
        for key, value in innovation_actions.items():
            if key in description:
                action = value
                break

        responses = {
            'projects': lambda: "Ð˜Ð½Ð½Ð¾Ð²Ð°Ñ†Ð¸Ð¾Ð½Ð½Ñ‹Ðµ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ñ‹:\n" + \
                             "ÐÐºÑ‚Ð¸Ð²Ð½Ñ‹Ñ…: 8\n" + \
                             "Ð—Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¾: 5\n" + \
                             "ÐÐ° Ñ€Ð°ÑÑÐ¼Ð¾Ñ‚Ñ€ÐµÐ½Ð¸Ð¸: 3\n" + \
                             "ÐžÐ±Ñ‰Ð¸Ð¹ Ð±ÑŽÐ´Ð¶ÐµÑ‚: " + self._format_currency(5000000) + " Ñ€ÑƒÐ±.",
            'ideas': lambda: "Ð˜Ð½Ð½Ð¾Ð²Ð°Ñ†Ð¸Ð¾Ð½Ð½Ñ‹Ðµ Ð¸Ð´ÐµÐ¸:\n" + \
                          "Ð’ Ð±Ð°Ð½ÐºÐµ Ð¸Ð´ÐµÐ¹: 45\n" + \
                          "ÐÐ° Ð¾Ñ†ÐµÐ½ÐºÐµ: 12\n" + \
                          "ÐžÐ´Ð¾Ð±Ñ€ÐµÐ½Ð¾: 8\n" + \
                          "Ð ÐµÐ°Ð»Ð¸Ð·ÑƒÐµÑ‚ÑÑ: 3",
            'status': lambda: "Ð¡Ñ‚Ð°Ñ‚ÑƒÑ Ð¸Ð½Ð½Ð¾Ð²Ð°Ñ†Ð¸Ð¹:\n" + \
                           "ÐžÐ±Ñ‰Ð¸Ð¹ Ð¿Ñ€Ð¾Ð³Ñ€ÐµÑÑ: 75%\n" + \
                           "Ð£ÑÐ¿ÐµÑˆÐ½Ñ‹Ñ… Ð²Ð½ÐµÐ´Ñ€ÐµÐ½Ð¸Ð¹: 12\n" + \
                           "Ð­ÐºÐ¾Ð½Ð¾Ð¼Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ ÑÑ„Ñ„ÐµÐºÑ‚: " + self._format_currency(2500000) + " Ñ€ÑƒÐ±.\n" + \
                           "ROI: 165%",
            'technologies': lambda: "ÐÐ¾Ð²Ñ‹Ðµ Ñ‚ÐµÑ…Ð½Ð¾Ð»Ð¾Ð³Ð¸Ð¸:\n" + \
                                "Ð’Ð½ÐµÐ´Ñ€ÐµÐ½Ð¾: 5\n" + \
                                "Ð¢ÐµÑÑ‚Ð¸Ñ€ÑƒÐµÑ‚ÑÑ: 3\n" + \
                                "ÐÐ° Ð¸Ð·ÑƒÑ‡ÐµÐ½Ð¸Ð¸: 8\n" + \
                                "Ð­Ñ„Ñ„ÐµÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ: +25%",
            'results': lambda: "Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ð¸Ð½Ð½Ð¾Ð²Ð°Ñ†Ð¸Ð¹:\n" + \
                            "Ð£Ð»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¾Ñ†ÐµÑÑÐ¾Ð²: 35%\n" + \
                            "Ð¡Ð½Ð¸Ð¶ÐµÐ½Ð¸Ðµ Ð·Ð°Ñ‚Ñ€Ð°Ñ‚: 15%\n" + \
                            "Ð Ð¾ÑÑ‚ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚Ð¸: 28%\n" + \
                            "ÐÐ¾Ð²Ñ‹Ðµ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ñ‹: 3",
            'budget': lambda: "Ð‘ÑŽÐ´Ð¶ÐµÑ‚ Ð¸Ð½Ð½Ð¾Ð²Ð°Ñ†Ð¸Ð¹:\n" + \
                           "Ð’Ñ‹Ð´ÐµÐ»ÐµÐ½Ð¾: " + self._format_currency(10000000) + " Ñ€ÑƒÐ±.\n" + \
                           "Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¾: 65%\n" + \
                           "ROI Ñ‚ÐµÐºÑƒÑ‰Ð¸Ð¹: 145%\n" + \
                           "ÐŸÑ€Ð¾Ð³Ð½Ð¾Ð· Ð¾ÐºÑƒÐ¿Ð°ÐµÐ¼Ð¾ÑÑ‚Ð¸: 18 Ð¼ÐµÑÑÑ†ÐµÐ²"
        }

        return responses.get(action or 'unknown', lambda: "ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»Ð¸Ñ‚ÑŒ Ñ‚Ð¸Ð¿ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸ Ñ Ð¸Ð½Ð½Ð¾Ð²Ð°Ñ†Ð¸ÑÐ¼Ð¸. ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, ÑƒÑ‚Ð¾Ñ‡Ð½Ð¸Ñ‚Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ.")()

# Create a singleton instance
command_processor = CommandProcessor()

def process_command(command_type: str, entities: Dict) -> str:
    """Global function to process commands"""
    return command_processor.process_command(command_type, entities)